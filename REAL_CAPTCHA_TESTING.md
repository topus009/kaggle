# Тестирование модели на реальных CAPTCHA FSSP

Этот набор скриптов позволяет:
1. **Загружать реальные CAPTCHA** с FSSP API
2. **Тестировать модель** на реальных данных
3. **Сохранять результаты** в текстовый файл

## Структура

- `test_real_captcha.py` - основной скрипт для загрузки и тестирования CAPTCHA
- `predict.py` - скрипт для предсказания текста на изображениях
- `test_captchas/` - папка где сохраняются загруженные CAPTCHA
- `real_results/` - папка где сохраняются результаты предсказаний

## Использование

### Вариант 1: Интерактивный режим
```bash
python test_real_captcha.py
```
Программа спросит сколько CAPTCHA загрузить (по умолчанию 5)

### Вариант 2: Загрузить определенное количество CAPTCHA
```bash
python test_real_captcha.py << EOF
10
EOF
```

## Процесс работы

1. **Загрузка CAPTCHA**
   - Подключается к FSSP API
   - Скачивает CAPTCHA в формате base64
   - Сохраняет их как PNG файлы в папку `test_captchas/`

2. **Предсказание**
   - Загружает обученную модель из `final-results/output/model.keras`
   - Обрабатывает каждое изображение
   - Предсказывает текст используя CTC декодирование

3. **Сохранение результатов**
   - Все предсказания сохраняются в `real_results/predictions.txt`
   - Также сохраняются изображения с аннотациями

## Результаты

Результаты можно найти в `real_results/predictions.txt`:

```
============================================================
РЕЗУЛЬТАТЫ ПРЕДСКАЗАНИЙ CAPTCHA
============================================================

Обработано изображений: 2
------------------------------------------------------------

captcha_20251029_234905_164_1.png: б8м6ж
captcha_20251029_234906_140_2.png: лгвжг

============================================================
```

## API FSSP

Используемый API:
- **URL**: `https://is.fssp.gov.ru/refresh_visual_captcha/`
- **Метод**: GET
- **Возвращает**: JSONP с полем `image` (base64 PNG)

## Требования

Убедитесь что установлены все зависимости:
```bash
pip install -r requirements.txt
```

Необходимо иметь:
- Python 3.8+
- TensorFlow 2.10+
- Requests 2.28+
- Модель в `final-results/output/model.keras`
- Данные с метками в `images/labels.csv`

## Производительность

- Загрузка 1 CAPTCHA: ~0.5-1 сек
- Предсказание на 1 изображении: ~0.1-0.2 сек
- Модель работает с 95% точностью на Kaggle датасете

## Примечания

- Скрипт не показывает изображения на экране (без GUI)
- Все результаты сохраняются в текстовый файл
- Папки `test_captchas/` и `real_results/` добавлены в `.gitignore`
- API может иметь rate limiting - рекомендуется не более 10-20 CAPTCHA за раз
